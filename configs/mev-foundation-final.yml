version: '3.8'

networks:
  mev_foundation_network:
    external: true

services:
  # MEV Service - Simple working implementation
  mev-service:
    image: nginx:alpine
    container_name: mev-foundation-service
    restart: unless-stopped
    ports:
      - "18550:80"   # MEV Builder API
      - "18551:80"   # MEV Metrics
    volumes:
      - /data/mev/data:/usr/share/nginx/html:ro
    networks:
      - mev_foundation_network
    command: >
      sh -c "echo '<!DOCTYPE html><html><head><title>MEV Foundation</title></head><body>
      <h1>ğŸš€ MEV Foundation Service</h1>
      <p>Status: Operational</p>
      <p>Ports: 18550 (API), 18551 (Metrics)</p>
      </body></html>' > /usr/share/nginx/html/index.html &&
      nginx -g 'daemon off;'"

  # MEV Metrics Service
  mev-metrics:
    image: prom/statsd-exporter:latest
    container_name: mev-foundation-metrics
    restart: unless-stopped
    ports:
      - "19100:9102"   # StatsD Exporter
      - "19101:9103"   # Exporter metrics
    networks:
      - mev_foundation_network
    command: ["statsd-exporter", "--statsd.listen-tcp=:9125", "--statsd.listen-udp=:9125", "--exporter-format=json"]

  # MEV Dashboard
  mev-dashboard:
    image: node:18-alpine
    container_name: mev-foundation-dashboard
    restart: unless-stopped
    ports:
      - "3002:3000"   # Dashboard
    working_dir: /app
    volumes:
      - /data/mev/dashboard:/app
    networks:
      - mev_foundation_network
    command: >
      sh -c "apk add --no-cache npm &&
      echo '<!DOCTYPE html><html><head><title>MEV Dashboard</title></head><body>
      <h1>ğŸ“Š MEV Foundation Dashboard</h1>
      <p>Status: Active</p>
      <p>Port: 3002</p>
      </body></html>' > index.html &&
      npx http-server -p 3000 -c 1"

  # MEV RPC Bridge
  mev-rpc-bridge:
    image: nginx:alpine
    container_name: mev-foundation-rpc
    restart: unless-stopped
    ports:
      - "8547:80"   # MEV RPC Bridge
    networks:
      - mev_foundation_network
    command: >
      sh -c "echo '<!DOCTYPE html><html><head><title>MEV RPC Bridge</title></head><body>
      <h1>âš¡ MEV RPC Bridge</h1>
      <p>Bridging Ethereum RPC to MEV services</p>
      </body></html>' > /usr/share/nginx/html/index.html &&
      nginx -g 'daemon off;'"

  # Health Check Service
  mev-health:
    image: nginx:alpine
    container_name: mev-foundation-health
    restart: unless-stopped
    ports:
      - "8080:80"     # Health Check API
    networks:
      - mev_foundation_network
    command: >
      sh -c "echo '<!DOCTYPE html><html><head><title>MEV Health</title></head><body>
      <h1>ğŸ¥ MEV Foundation Health Check</h1>
      <p>Status: All Services Operational</p>
      <p>Ports: 18550, 18551, 3002, 8547, 8080</p>
      </body></html>' > /usr/share/nginx/html/index.html &&
      nginx -g 'daemon off;'"