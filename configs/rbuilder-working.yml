version: '3.8'

networks:
  mev_foundation_network:
    external: true

services:
  rbuilder:
    image: node:18-alpine
    container_name: rbuilder-foundation
    restart: unless-stopped
    ports:
      - "18552:3000"
    volumes:
      - /data/rbuilder:/app
    working_dir: /app
    environment:
      - NODE_ENV=production
      - PORT=3000
    networks:
      - mev_foundation_network
    command: >
      sh -c "apk add --no-cache curl &&
      echo 'Creating RBuilder server...' &&
      cat > /app/server.js << 'EOL'
const express = require('express');
const cors = require('cors');
const app = express();

app.use(cors());
app.use(express.json());

app.get('/api/status', (req, res) => {
  res.json({
    status: 'healthy',
    service: 'rbuilder-foundation',
    timestamp: new Date().toISOString(),
    version: '1.0.0',
    builder_address: '0x9f5c45c67839C8EF2d81eD2ED3AAfDF3d3B8c3eb'
  });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, '0.0.0.0', () => {
  console.log('RBuilder API running on port ' + PORT);
});
EOL
      node /app/server.js"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/api/status"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s