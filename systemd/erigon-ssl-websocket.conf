# Erigon SSL WebSocket Configuration for MEV Operations
# Final consolidated configuration with SSL support
[Service]
# Use standard Erigon binary with optimized MEV parameters
ExecStart=
ExecStart=/usr/local/bin/erigon \
    --datadir=/data/blockchain/storage/erigon \
    --chain=mainnet \
    --prune.mode=full \
    --http \
    --http.addr=127.0.0.1 \
    --http.port=8545 \
    --http.vhosts=localhost,127.0.1 \
    --http.api=eth,net,web3,txpool,erigon,debug \
    --ws \
    --ws.port=8546 \
    --ws.tls \
    --ws.tls.cert=/opt/mev-lab/certs/erigon.crt \
    --ws.tls.key=/opt/mev-lab/certs/erigon.key \
    --authrpc.addr=127.0.0.1 \
    --authrpc.port=8552 \
    --authrpc.jwtsecret=/data/blockchain/storage/jwt-secret-common.hex \
    --authrpc.vhosts=* \
    --port=30303 \
    --nat=extip:51.159.82.58 \
    --maxpeers=120 \
    --batchSize=512m \
    --db.read.concurrency=512 \
    --sync.loop.block.limit=4000 \
    --torrent.download.rate=60mb \
    --torrent.upload.rate=30mb \
    --torrent.conns.perfile=12 \
    --torrent.download.slots=6 \
    --txpool.accountslots=32 \
    --txpool.globalslots=8192 \
    --txpool.accountqueue=64 \
    --txpool.globalqueue=4096 \
    --txpool.pricelimit=1000000000 \
    --txpool.pricebump=10 \
    --rpc.gascap=50000000 \
    --rpc.txfeecap=100 \
    --rpc.allow-unprotected-txs=false \
    --log.console.verbosity=info \
    --log.dir.path=/var/log/erigon \
    --log.dir.verbosity=2 \
    --metrics \
    --metrics.addr=127.0.0.1:6062 \
    --externalcl \
    --db.size.limit=2TB \
    --memory.limit=16G \
    --sync.loop.block.limit=4000 \
    --batchSize=512m \
    --torrent.download.rate=60mb \
    --torrent.upload.rate=30mb \
    --torrent.conns.perfile=12 \
    --torrent.download.slots=6

# SSL WebSocket environment variables
Environment="ERIGON_SSL_ENABLED=true"
Environment="ERIGON_WS_TLS=true"
Environment="ERIGON_CERT_PATH=/opt/mev-certs/erigon.crt"
Environment="ERIGON_KEY_PATH=/opt/mev-certs/erigon.key"

# Resource limits optimized for MEV operations
MemoryMax=16G
MemoryHigh=14G
CPUQuota=300%
LimitNOFILE=1048576
TimeoutStartSec=600
TimeoutStopSec=300
RuntimeMaxSec=infinity

# Service restart policy
Restart=always
RestartSec=30
StartLimitBurst=5
StartLimitInterval=10

# Service description
Description=Erigon Ethereum Client v3.2.0 with SSL WebSocket Support (Production MEV Optimized)